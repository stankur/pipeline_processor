app = "worker-app"
primary_region = "iad"

[build]
  dockerfile = "Dockerfile"

[env]
  PORT = "8080"
  NET_DB_PATH = "/data/app.db"

# Single process: Flask API; worker runs via API-triggered threads
[processes]
  app = "gunicorn -w 1 -k gthread --threads 8 -b 0.0.0.0:${PORT:-8080} api:app"

[[services]]
  protocol = "tcp"
  internal_port = 8080
  processes = ["app"]
  [[services.ports]]
    handlers = ["http"]
    port = 80
  [[services.ports]]
    handlers = ["tls", "http"]
    port = 443
  [services.concurrency]
    type = "requests"
    hard_limit = 50
    soft_limit = 40

[[mounts]]
  source = "data"
  destination = "/data"

[vm]
  memory = 512
  cpus = 1
  cpu_kind = "shared"
